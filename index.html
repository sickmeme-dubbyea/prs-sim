<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRS Stage & Match Builder</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Barlow+Condensed:wght@400;600;700;900&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d0f0c;
    --surface: #131610;
    --surface2: #1a1e17;
    --border: #2e3528;
    --border-bright: #4a5540;
    --amber: #c8922a;
    --amber-bright: #e8a832;
    --amber-dim: #7a5518;
    --green: #5a7a3a;
    --green-bright: #7aaa4a;
    --text: #c8cfc0;
    --text-dim: #6a7560;
    --text-bright: #e8efe0;
    --red: #8a3a2a;
    --red-bright: #c85a3a;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Share Tech Mono', monospace;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    padding: 0;
    overflow-x: hidden;
  }

  /* SCANLINE OVERLAY */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      rgba(0,0,0,0.08) 2px,
      rgba(0,0,0,0.08) 4px
    );
    pointer-events: none;
    z-index: 1000;
  }

  /* HEADER */
  header {
    background: var(--surface);
    border-bottom: 2px solid var(--amber);
    padding: 0;
    position: relative;
    overflow: hidden;
  }

  header::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--amber-bright), transparent);
    animation: sweep 4s ease-in-out infinite;
  }

  @keyframes sweep {
    0%, 100% { opacity: 0; transform: translateX(-100%); }
    50% { opacity: 1; transform: translateX(100%); }
  }

  .header-inner {
    display: flex;
    align-items: center;
    gap: 20px;
    padding: 18px 30px;
  }

  .reticle {
    width: 48px;
    height: 48px;
    flex-shrink: 0;
  }

  .reticle svg {
    width: 100%;
    height: 100%;
    animation: reticle-spin 20s linear infinite;
  }

  @keyframes reticle-spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  .header-text h1 {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 2rem;
    letter-spacing: 0.12em;
    color: var(--amber-bright);
    text-transform: uppercase;
    line-height: 1;
  }

  .header-text p {
    font-size: 0.72rem;
    color: var(--text-dim);
    letter-spacing: 0.25em;
    margin-top: 4px;
  }

  .header-status {
    margin-left: auto;
    text-align: right;
    font-size: 0.65rem;
    color: var(--text-dim);
    letter-spacing: 0.15em;
  }

  .status-dot {
    display: inline-block;
    width: 7px;
    height: 7px;
    border-radius: 50%;
    background: var(--green-bright);
    margin-right: 5px;
    animation: pulse 2s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
  }

  /* LAYOUT */
  .main-grid {
    display: grid;
    grid-template-columns: 360px 1fr;
    gap: 0;
    min-height: calc(100vh - 90px);
  }

  /* SIDEBAR */
  .sidebar {
    background: var(--surface);
    border-right: 1px solid var(--border);
    padding: 24px 20px;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .panel {
    background: var(--surface2);
    border: 1px solid var(--border);
    padding: 16px;
    position: relative;
    transition: border-color 0.2s;
  }

  .panel:hover {
    border-color: var(--border-bright);
  }

  .panel-label {
    font-size: 0.6rem;
    letter-spacing: 0.3em;
    color: var(--amber);
    text-transform: uppercase;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .panel-label::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  .field-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
    gap: 10px;
  }

  .field-row:last-child { margin-bottom: 0; }

  label.field-label {
    font-size: 0.7rem;
    color: var(--text-dim);
    letter-spacing: 0.1em;
    white-space: nowrap;
  }

  input[type="number"], select {
    background: var(--bg);
    border: 1px solid var(--border);
    color: var(--amber-bright);
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.85rem;
    padding: 6px 10px;
    text-align: right;
    outline: none;
    width: 120px;
    transition: border-color 0.2s, box-shadow 0.2s;
    -webkit-appearance: none;
    appearance: none;
  }

  input[type="number"]:focus, select:focus {
    border-color: var(--amber);
    box-shadow: 0 0 0 2px rgba(200, 146, 42, 0.15);
  }

  select {
    cursor: pointer;
    text-align: left;
    width: 140px;
  }

  select option {
    background: var(--surface2);
    color: var(--text);
  }

  /* RADIO TABS */
  .mode-tabs {
    display: flex;
    gap: 0;
  }

  .mode-tabs label {
    flex: 1;
    text-align: center;
    padding: 8px;
    font-size: 0.7rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    border: 1px solid var(--border);
    cursor: pointer;
    transition: all 0.2s;
    color: var(--text-dim);
    user-select: none;
  }

  .mode-tabs label:first-child { border-right: none; }

  .mode-tabs input[type="radio"] { display: none; }

  .mode-tabs input[type="radio"]:checked + span,
  .mode-tabs label:has(input:checked) {
    color: var(--amber-bright);
    background: rgba(200, 146, 42, 0.12);
    border-color: var(--amber-dim);
  }

  .mode-tabs label:hover {
    color: var(--text);
    background: rgba(255,255,255,0.03);
  }

  /* CHECKBOXES */
  .checkbox-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 6px;
  }

  .cb-label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.7rem;
    color: var(--text-dim);
    cursor: pointer;
    padding: 5px 8px;
    border: 1px solid var(--border);
    transition: all 0.15s;
    letter-spacing: 0.05em;
    user-select: none;
  }

  .cb-label:hover {
    color: var(--text);
    border-color: var(--border-bright);
  }

  .cb-label input[type="checkbox"] { display: none; }

  .cb-box {
    width: 12px;
    height: 12px;
    border: 1px solid var(--text-dim);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: all 0.15s;
  }

  .cb-label:has(input:checked) .cb-box {
    background: var(--amber);
    border-color: var(--amber-bright);
  }

  .cb-label:has(input:checked) {
    color: var(--text-bright);
    border-color: var(--amber-dim);
  }

  .cb-label:has(input:checked) .cb-box::after {
    content: '✓';
    font-size: 9px;
    color: var(--bg);
    line-height: 1;
  }

  /* MATCH SETTINGS */
  #matchPanel {
    transition: opacity 0.3s, transform 0.3s;
  }

  #matchPanel.hidden {
    opacity: 0.3;
    pointer-events: none;
  }

  /* GENERATE BUTTON */
  .gen-btn {
    background: var(--amber);
    color: var(--bg);
    border: none;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 1.1rem;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    padding: 14px 20px;
    cursor: pointer;
    width: 100%;
    position: relative;
    overflow: hidden;
    transition: background 0.2s, transform 0.1s;
    margin-top: 10px;
  }

  .gen-btn:hover {
    background: var(--amber-bright);
  }

  .gen-btn:active {
    transform: scale(0.98);
    background: var(--amber-dim);
  }

  .gen-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
    transform: translateX(-100%);
    transition: transform 0.4s;
  }

  .gen-btn:hover::before {
    transform: translateX(100%);
  }

  /* OUTPUT AREA */
  .output-area {
    padding: 24px;
    overflow-y: auto;
  }

  .empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    min-height: 400px;
    color: var(--text-dim);
    font-size: 0.7rem;
    letter-spacing: 0.2em;
    gap: 20px;
    opacity: 0.5;
  }

  .empty-reticle {
    width: 80px;
    height: 80px;
    border: 1px solid currentColor;
    border-radius: 50%;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .empty-reticle::before, .empty-reticle::after {
    content: '';
    position: absolute;
    background: currentColor;
  }

  .empty-reticle::before {
    width: 1px;
    height: 100%;
  }

  .empty-reticle::after {
    width: 100%;
    height: 1px;
  }

  /* STAGE CARDS */
  .stage-card {
    background: var(--surface);
    border: 1px solid var(--border);
    margin-bottom: 16px;
    animation: fadeIn 0.4s ease forwards;
    opacity: 0;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .stage-header {
    background: var(--surface2);
    border-bottom: 1px solid var(--border);
    padding: 10px 16px;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .stage-num {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 1.3rem;
    font-weight: 900;
    color: var(--amber-bright);
    letter-spacing: 0.1em;
    min-width: 80px;
  }

  .stage-meta {
    display: flex;
    gap: 20px;
    margin-left: auto;
  }

  .meta-item {
    font-size: 0.65rem;
    letter-spacing: 0.15em;
    color: var(--text-dim);
  }

  .meta-item span {
    color: var(--green-bright);
    font-size: 0.85rem;
  }

  .stage-body {
    padding: 16px;
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 20px;
  }

  /* TARGET TABLE */
  .target-table {
    border-collapse: collapse;
    font-size: 0.72rem;
  }

  .target-table th {
    font-size: 0.6rem;
    letter-spacing: 0.2em;
    color: var(--amber);
    text-align: left;
    padding: 4px 12px 8px 0;
    text-transform: uppercase;
    border-bottom: 1px solid var(--border);
    font-weight: normal;
  }

  .target-table td {
    padding: 6px 12px 6px 0;
    border-bottom: 1px solid rgba(46, 53, 40, 0.5);
    color: var(--text);
  }

  .target-table td:first-child {
    color: var(--amber-bright);
    font-weight: bold;
  }

  .target-table tr:last-child td {
    border-bottom: none;
  }

  /* COURSE OF FIRE */
  .cof-section {
    border-left: 1px solid var(--border);
    padding-left: 20px;
  }

  .cof-label {
    font-size: 0.6rem;
    letter-spacing: 0.25em;
    color: var(--amber);
    text-transform: uppercase;
    margin-bottom: 12px;
  }

  .position-block {
    margin-bottom: 14px;
  }

  .position-name {
    font-size: 0.65rem;
    letter-spacing: 0.2em;
    color: var(--green-bright);
    text-transform: uppercase;
    margin-bottom: 6px;
  }

  .shot-sequence {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    align-items: center;
  }

  .shot-chip {
    background: rgba(200, 146, 42, 0.1);
    border: 1px solid var(--amber-dim);
    color: var(--amber-bright);
    padding: 3px 9px;
    font-size: 0.72rem;
    letter-spacing: 0.05em;
    font-family: 'Share Tech Mono', monospace;
  }

  .shot-arrow {
    color: var(--text-dim);
    font-size: 0.7rem;
  }

  .positions-badge {
    font-size: 0.65rem;
    color: var(--text-dim);
    letter-spacing: 0.1em;
    margin-bottom: 4px;
  }

  /* DIVIDER */
  .divider {
    height: 1px;
    background: linear-gradient(90deg, var(--amber-dim), transparent);
    margin: 6px 0;
  }

  /* SCROLLBAR */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--border-bright); }

  /* RESPONSIVE */
  @media (max-width: 768px) {
    .main-grid { grid-template-columns: 1fr; }
    .stage-body { grid-template-columns: 1fr; }
    .cof-section { border-left: none; border-top: 1px solid var(--border); padding-left: 0; padding-top: 16px; }
    .header-text h1 { font-size: 1.4rem; }
    .header-status { display: none; }
  }
</style>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="reticle">
      <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="24" cy="24" r="22" stroke="#c8922a" stroke-width="1"/>
        <circle cx="24" cy="24" r="12" stroke="#c8922a" stroke-width="0.75" stroke-dasharray="3 3"/>
        <circle cx="24" cy="24" r="3" stroke="#e8a832" stroke-width="1.5"/>
        <line x1="24" y1="0" x2="24" y2="16" stroke="#c8922a" stroke-width="1"/>
        <line x1="24" y1="32" x2="24" y2="48" stroke="#c8922a" stroke-width="1"/>
        <line x1="0" y1="24" x2="16" y2="24" stroke="#c8922a" stroke-width="1"/>
        <line x1="32" y1="24" x2="48" y2="24" stroke="#c8922a" stroke-width="1"/>
        <line x1="20" y1="4" x2="22" y2="4" stroke="#c8922a" stroke-width="0.75"/>
        <line x1="26" y1="4" x2="28" y2="4" stroke="#c8922a" stroke-width="0.75"/>
        <line x1="20" y1="44" x2="22" y2="44" stroke="#c8922a" stroke-width="0.75"/>
        <line x1="26" y1="44" x2="28" y2="44" stroke="#c8922a" stroke-width="0.75"/>
      </svg>
    </div>
    <div class="header-text">
      <h1>PRS Stage Builder</h1>
      <p>PRECISION RIFLE SERIES // MATCH & STAGE GENERATOR</p>
    </div>
    <div class="header-status">
      <div><span class="status-dot"></span>SYSTEM READY</div>
      <div style="margin-top:4px">BUILD v2.1</div>
    </div>
  </div>
</header>

<div class="main-grid">

  <!-- SIDEBAR -->
  <aside class="sidebar">

    <div class="panel">
      <div class="panel-label">Mode Select</div>
      <div class="mode-tabs">
        <label>
          <input type="radio" name="mode" value="single" checked onchange="updateMode()">
          <span>Single Stage</span>
        </label>
        <label>
          <input type="radio" name="mode" value="match" onchange="updateMode()">
          <span>Match Mode</span>
        </label>
      </div>
    </div>

    <div class="panel">
      <div class="panel-label">Range Parameters</div>
      <div class="field-row">
        <label class="field-label">MIN DISTANCE (YD)</label>
        <input type="number" id="minDist" value="400">
      </div>
      <div class="field-row">
        <label class="field-label">MAX DISTANCE (YD)</label>
        <input type="number" id="maxDist" value="800">
      </div>
    </div>

    <div class="panel">
      <div class="panel-label">Stage Configuration</div>
      <div class="field-row">
        <label class="field-label">TARGET COUNT</label>
        <input type="number" id="targetCount" value="4" min="1" max="10">
      </div>
      <div class="field-row">
        <label class="field-label">FOCUS</label>
        <select id="focus">
          <option value="balanced">Balanced</option>
          <option value="wind">Wind</option>
          <option value="elevation">Elevation</option>
          <option value="small">Small Target</option>
          <option value="combined">Combined</option>
        </select>
      </div>
      <div class="field-row">
        <label class="field-label">ROUND MODE</label>
        <select id="roundMode">
          <option value="full">Full</option>
          <option value="mid">Mid Compression</option>
          <option value="low">Low Compression</option>
        </select>
      </div>
      <div class="field-row">
        <label class="field-label">UNITS</label>
        <select id="units">
          <option value="MOA">MOA</option>
          <option value="MIL">MIL</option>
        </select>
      </div>
    </div>

    <div class="panel">
      <div class="panel-label">Equipment</div>
      <div class="checkbox-grid">
        <label class="cb-label"><input type="checkbox" value="Barricade" checked><span class="cb-box"></span>Barricade</label>
        <label class="cb-label"><input type="checkbox" value="Tripod"><span class="cb-box"></span>Tripod</label>
        <label class="cb-label"><input type="checkbox" value="Tank Trap"><span class="cb-box"></span>Tank Trap</label>
        <label class="cb-label"><input type="checkbox" value="Rooftop"><span class="cb-box"></span>Rooftop</label>
        <label class="cb-label"><input type="checkbox" value="Prone"><span class="cb-box"></span>Prone</label>
        <label class="cb-label"><input type="checkbox" value="Modified Prone"><span class="cb-box"></span>Mod. Prone</label>
      </div>
    </div>

    <div class="panel" id="matchPanel">
      <div class="panel-label">Match Settings</div>
      <div class="field-row">
        <label class="field-label">STAGE COUNT</label>
        <input type="number" id="stageCount" value="8" min="1" max="20">
      </div>
      <div class="field-row">
        <label class="field-label">DIFFICULTY</label>
        <select id="difficulty">
          <option value="club">Club</option>
          <option value="regional">Regional</option>
          <option value="national">National</option>
        </select>
      </div>
    </div>

    <button class="gen-btn" onclick="generate()">▶ GENERATE</button>

  </aside>

  <!-- OUTPUT -->
  <main class="output-area" id="outputArea">
    <div class="empty-state" id="emptyState">
      <div class="empty-reticle"></div>
      <div>AWAITING STAGE GENERATION</div>
    </div>
    <div id="output"></div>
  </main>

</div>

<script>
  const MOA_OPTIONS = [0.5, 1, 1.5, 2, 3, 4];
  const MIL_OPTIONS = [0.2, 0.3, 0.5, 0.7, 1.0, 1.2];

  function rand(min, max) { return Math.random() * (max - min) + min; }
  function randInt(min, max) { return Math.floor(rand(min, max)); }
  function shuffle(arr) { return [...arr].sort(() => Math.random() - 0.5); }

  function updateMode() {
    const isMatch = document.querySelector('input[name="mode"]:checked').value === 'match';
    document.getElementById('matchPanel').classList.toggle('hidden', !isMatch);
  }

  // Init
  updateMode();

  function generateDistances(min, max, count) {
    let arr = [];
    for (let i = 0; i < count; i++) arr.push(Math.round(rand(min, max)));
    return arr.sort((a, b) => a - b);
  }

  function pickPlate(focus, units) {
    let options = units === 'MOA' ? MOA_OPTIONS : MIL_OPTIONS;
    let pool = [...options];
    if (focus === 'small') pool = options.slice(0, 2);
    else if (focus === 'elevation') pool = options.slice(1, 4);
    else if (focus === 'wind') pool = options.slice(1, 3);
    return pool[randInt(0, pool.length)];
  }

  function getRoundProfile(mode) {
    if (mode === 'full') return { rounds: randInt(10, 13), time: 105 };
    if (mode === 'mid') return { rounds: randInt(6, 9), time: randInt(75, 91) };
    return { rounds: randInt(4, 7), time: randInt(45, 61) };
  }

  function allocateRounds(targets, totalRounds) {
    let allocation = targets.map(t => ({ ...t, rounds: 0 }));
    let remaining = totalRounds;
    for (let i = 0; i < allocation.length && remaining > 0; i++, remaining--) allocation[i].rounds++;
    while (remaining > 0) { allocation[randInt(0, allocation.length)].rounds++; remaining--; }
    return allocation;
  }

  function buildEngagementSequence(targets) {
    let pool = [];
    targets.forEach(t => { for (let i = 0; i < t.rounds; i++) pool.push(t.id); });
    pool = shuffle(pool);
    for (let i = 1; i < pool.length; i++) {
      if (pool[i] === pool[i - 1]) {
        let swapIndex = pool.findIndex((val, j) => j > i && val !== pool[i]);
        if (swapIndex > i) [pool[i], pool[swapIndex]] = [pool[swapIndex], pool[i]];
      }
    }
    return pool;
  }

  function splitAcrossPositions(sequence, positions) {
    let splits = [], perPos = Math.floor(sequence.length / positions.length);
    let remainder = sequence.length % positions.length, index = 0;
    for (let i = 0; i < positions.length; i++) {
      let count = perPos + (i === positions.length - 1 ? remainder : 0);
      splits.push(sequence.slice(index, index + count));
      index += count;
    }
    return splits;
  }

  function buildStage(globalMin, globalMax) {
    let targetCount = parseInt(document.getElementById('targetCount').value);
    let focus = document.getElementById('focus').value;
    let roundMode = document.getElementById('roundMode').value;
    let units = document.getElementById('units').value;
    let equipment = Array.from(document.querySelectorAll('input[type=checkbox]:checked')).map(e => e.value);
    if (!equipment.length) equipment = ['Barricade', 'Prone'];

    let distances = generateDistances(globalMin, globalMax, targetCount);
    let targets = distances.map((d, i) => ({ id: 'T' + (i + 1), distance: d, size: pickPlate(focus, units) }));
    targets = shuffle(targets);

    let roundProfile = getRoundProfile(roundMode);
    let allocated = allocateRounds(targets, roundProfile.rounds);
    let engagementOrder = buildEngagementSequence(allocated);

    let positionsCount = roundMode === 'full' ? 3 : (roundMode === 'mid' ? 2 : 1);
    let positions = shuffle(equipment).slice(0, Math.min(positionsCount, equipment.length));
    let splitSequence = splitAcrossPositions(engagementOrder, positions);

    return { targets: allocated, engagement: engagementOrder, split: splitSequence, positions, totalRounds: roundProfile.rounds, time: roundProfile.time, units };
  }

  function renderStage(stage, index = null) {
    let title = index !== null ? `STAGE ${String(index + 1).padStart(2, '0')}` : 'SINGLE STAGE';
    let delay = (index || 0) * 80;

    let html = `<div class="stage-card" style="animation-delay:${delay}ms">`;

    // Header
    html += `<div class="stage-header">
      <div class="stage-num">${title}</div>
      <div class="stage-meta">
        <div class="meta-item">TIME LIMIT<br><span>${stage.time}s</span></div>
        <div class="meta-item">TOTAL RDS<br><span>${stage.totalRounds}</span></div>
        <div class="meta-item">POSITIONS<br><span>${stage.positions.length}</span></div>
      </div>
    </div>`;

    html += `<div class="stage-body">`;

    // Targets table
    html += `<div>
      <table class="target-table">
        <thead><tr><th>TGT</th><th>DIST</th><th>SIZE</th><th>RDS</th></tr></thead>
        <tbody>`;
    stage.targets.forEach(t => {
      html += `<tr><td>${t.id}</td><td>${t.distance}yd</td><td>${t.size} ${stage.units}</td><td>${t.rounds}</td></tr>`;
    });
    html += `</tbody></table></div>`;

    // Course of fire
    html += `<div class="cof-section">
      <div class="cof-label">Course of Fire</div>`;

    stage.positions.forEach((pos, i) => {
      let shots = stage.split[i];
      html += `<div class="position-block">
        <div class="position-name">◆ ${pos}</div>
        <div class="shot-sequence">`;
      shots.forEach((s, j) => {
        html += `<div class="shot-chip">${s}</div>`;
        if (j < shots.length - 1) html += `<span class="shot-arrow">›</span>`;
      });
      html += `</div></div>`;
    });

    html += `</div></div></div>`;
    return html;
  }

  function generate() {
    let mode = document.querySelector('input[name="mode"]:checked').value;
    let globalMin = parseInt(document.getElementById('minDist').value);
    let globalMax = parseInt(document.getElementById('maxDist').value);

    if (globalMin >= globalMax) {
      alert('MIN distance must be less than MAX distance.');
      return;
    }

    document.getElementById('emptyState').style.display = 'none';
    let output = '';

    if (mode === 'single') {
      output = renderStage(buildStage(globalMin, globalMax));
    } else {
      let stageCount = parseInt(document.getElementById('stageCount').value);
      for (let i = 0; i < stageCount; i++) output += renderStage(buildStage(globalMin, globalMax), i);
    }

    document.getElementById('output').innerHTML = output;
  }
</script>

</body>
</html>
